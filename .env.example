# ═══════════════════════════════════════════════════════════════════════
#  unifi2netbox – Environment Configuration
# ═══════════════════════════════════════════════════════════════════════
#  Copy this file to .env and fill in your credentials.
#  See docs/configuration.md for detailed descriptions of every variable.
# ═══════════════════════════════════════════════════════════════════════

# ── UniFi Connection ──────────────────────────────────────────────────
# Controller URLs (comma-separated or JSON array)
UNIFI_URLS=https://controller.example.com/proxy/network/integration/v1

# Authentication – choose ONE method:
#   Option A: Integration API (recommended)
UNIFI_API_KEY=your-unifi-api-key
UNIFI_API_KEY_HEADER=X-API-KEY
# Verify UniFi TLS certificates (recommended: true)
UNIFI_VERIFY_SSL=true
# Persist UniFi session cookies/metadata to ~/.unifi_session.json
UNIFI_PERSIST_SESSION=true
#   Option B: Legacy API (username/password)
# UNIFI_USERNAME=your-unifi-username
# UNIFI_PASSWORD=your-unifi-password
# UNIFI_MFA_SECRET=your-unifi-mfa-secret

# ── NetBox Connection ─────────────────────────────────────────────────
NETBOX_URL=https://netbox.example.com
NETBOX_TOKEN=your-netbox-api-token
NETBOX_TENANT=Organization Name
# Verify NetBox TLS certificates (recommended: true)
NETBOX_VERIFY_SSL=true

# Status for newly created devices (default: offline)
NETBOX_DEVICE_STATUS=offline

# ── Serial Number Handling ────────────────────────────────────────────
# Modes: mac (default), unifi, id, none
#   mac   – UniFi serial → MAC (uppercase, no colons) → device ID
#   unifi – only UniFi serial (may be empty)
#   id    – UniFi serial → device ID
#   none  – do not set serial in NetBox
NETBOX_SERIAL_MODE=mac

# ── VRF Handling ──────────────────────────────────────────────────────
# Modes: existing (default), none, create
#   existing – use VRF if it already exists, never create
#   none     – do not use VRFs at all
#   create   – create VRF if missing (named after site)
NETBOX_VRF_MODE=existing

# ── DHCP / Static IP ─────────────────────────────────────────────────
# Auto-discover DHCP ranges from UniFi network configs (default: true)
DHCP_AUTO_DISCOVER=true
# Manual DHCP ranges (merged with auto-discovered). Comma-separated CIDR.
# DHCP_RANGES=192.168.100.0/24
# Fallback gateway/DNS if UniFi network config lacks them:
# DEFAULT_GATEWAY=10.0.0.1
# DEFAULT_DNS=1.1.1.1,8.8.8.8

# ── Device Role Mapping ──────────────────────────────────────────────
# Individual role vars:
NETBOX_ROLE_WIRELESS=Wireless AP
NETBOX_ROLE_LAN=Switch
NETBOX_ROLE_GATEWAY=Gateway Firewall
NETBOX_ROLE_ROUTER=Router
NETBOX_ROLE_UNKNOWN=Network Device
# Or as JSON (overrides individual vars):
# NETBOX_ROLES={"WIRELESS":"Wireless AP","LAN":"Switch","GATEWAY":"Gateway Firewall","ROUTER":"Router","UNKNOWN":"Network Device"}

# ── Site Mapping ──────────────────────────────────────────────────────
UNIFI_USE_SITE_MAPPING=false
# UNIFI_SITE_MAPPINGS={"UniFi Site Name":"NetBox Site Name"}

# ── Feature Toggles ──────────────────────────────────────────────────
SYNC_INTERFACES=true
SYNC_VLANS=true
SYNC_WLANS=true
SYNC_CABLES=true
SYNC_STALE_CLEANUP=true

# ── Threading ─────────────────────────────────────────────────────────
# Reduce for smaller environments or if hitting API rate limits
# MAX_CONTROLLER_THREADS=5
# MAX_SITE_THREADS=8
# MAX_DEVICE_THREADS=8

# ── NetBox Cleanup ────────────────────────────────────────────────────
# ⚠️  DESTRUCTIVE – permanently deletes stale devices, orphan interfaces,
#     orphan IPs, orphan cables, and unused device types from NetBox.
#     Test with CLEANUP_STALE_DAYS=9999 first to see what would be deleted.
NETBOX_CLEANUP=false
# Grace period: devices must be offline for this many days before deletion.
# Set to 0 to delete immediately (use with caution!).
CLEANUP_STALE_DAYS=30

# ── Sync Interval ────────────────────────────────────────────────────
# How often to run the sync loop (in seconds).
#   0   = run once and exit (for cron/systemd timer use)
#   600 = every 10 minutes (recommended for Docker)
SYNC_INTERVAL=600

# ── HTTP Tuning ───────────────────────────────────────────────────────
UNIFI_REQUEST_TIMEOUT=15
UNIFI_HTTP_RETRIES=3
UNIFI_RETRY_BACKOFF_BASE=1.0
UNIFI_RETRY_BACKOFF_MAX=30.0
